# Система аудита качества коммуникаций

Веб-платформа для проведения аудитов качества коммуникаций (звонков, переписок) с формированием аналитических отчётов для компаний.

## Технологический стек

- **Frontend & Backend**: Next.js 14 (App Router) + React + TypeScript
- **База данных**: PostgreSQL (Neon)
- **ORM**: Prisma
- **Аутентификация**: NextAuth.js
- **UI компоненты**: Radix UI + Tailwind CSS
- **Графики**: Recharts
- **Экспорт PDF**: @react-pdf/renderer

## Основные возможности

### Для администратора
- Управление компаниями и их вводными данными
- Управление пользователями (аналитики, компании)
- Создание и версионирование анкет
- Настройка доступности анкет для компаний (тарифы)
- Управление шкалами оценок

### Для аналитика
- Создание и проведение аудитов
- Заполнение анкет с оценками и комментариями
- Сохранение черновиков
- Завершение аудитов

### Для компании
- Просмотр завершённых отчётов аудита
- Детальная аналитика по категориям
- Просмотр комментариев аналитиков
- Экспорт отчётов в PDF

## Архитектурные особенности

### Полная конфигурируемость
Система спроектирована так, что изменения в структуре анкет, правилах оценки и формате отчётов не требуют изменения кода. Всё настраивается через административный интерфейс.

### Версионирование анкет
Любые изменения анкеты создают новую версию, не влияя на исторические данные и старые аудиты.

### Динамический расчёт оценок
Итоговая оценка формируется автоматически на основе весов вопросов и подпунктов. Система автоматически адаптируется под структуру анкеты.

### Изоляция компаний
Каждая компания видит только свои данные. Глобальные рейтинги отсутствуют.

### История изменений
Все действия с аудитами фиксируются для обеспечения прозрачности и контроля.

## Установка и запуск

### 1. Клонирование и установка зависимостей

\`\`\`bash
npm install
\`\`\`

### 2. Настройка переменных окружения

Создайте файл `.env` на основе `.env.example`:

\`\`\`bash
cp .env.example .env
\`\`\`

Заполните переменные:

\`\`\`env
DATABASE_URL="postgresql://user:password@host:5432/database?sslmode=require"
NEXTAUTH_URL="http://localhost:3000"
NEXTAUTH_SECRET="your-secret-key"  # Сгенерируйте: openssl rand -base64 32
\`\`\`

### 3. Настройка базы данных

\`\`\`bash
# Применить схему к базе данных
npm run prisma:push

# Заполнить базу тестовыми данными
npm run seed
\`\`\`

Seed создаст:
- Администратора (email: `admin@example.com`, пароль: `admin123`)
- Дефолтную шкалу оценок (1 / 0.5 / 0)
- Анкеты из файла `Аналитика контроля качества отдела продаж.json`

### 4. Запуск в режиме разработки

\`\`\`bash
npm run dev
\`\`\`

Приложение будет доступно по адресу [http://localhost:3000](http://localhost:3000)

### 5. Сборка для продакшена

\`\`\`bash
npm run build
npm start
\`\`\`

## Структура проекта

\`\`\`
├── prisma/
│   ├── schema.prisma          # Схема базы данных
│   └── seed.ts                # Скрипт начального заполнения
├── src/
│   ├── app/
│   │   ├── admin/             # Админ-панель
│   │   ├── analyst/           # Интерфейс аналитика
│   │   ├── company/           # Интерфейс компании
│   │   ├── actions/           # Server Actions
│   │   ├── api/               # API Routes
│   │   └── login/             # Страница входа
│   ├── components/
│   │   └── ui/                # UI компоненты
│   └── lib/
│       ├── prisma.ts          # Prisma client
│       ├── auth.ts            # NextAuth конфигурация
│       ├── calculations.ts    # Расчёт оценок
│       └── utils.ts           # Утилиты
└── Аналитика контроля качества отдела продаж.json  # Дефолтные анкеты
\`\`\`

## Модель данных

### Основные сущности

- **User** - пользователи (Admin, Analyst, Company)
- **Company** - компании
- **CompanyInputData** - вводные данные компании
- **Questionnaire** - анкеты
- **QuestionnaireVersion** - версии анкет
- **Question** - вопросы/критерии
- **QuestionSubitem** - подпункты вопросов
- **ScoreScale** - шкалы оценок
- **Audit** - аудиты
- **AuditAnswer** - ответы в аудите
- **AuditHistory** - история изменений
- **CompanyQuestionnaire** - доступность анкет для компаний

## Основные сценарии использования

### 1. Администратор создаёт компанию

1. Переходит в "Компании" → "Добавить компанию"
2. Заполняет название, дату подключения
3. Добавляет вводные данные (скрипты, регламенты, доступы)
4. Настраивает доступные анкеты

### 2. Администратор создаёт пользователя

1. Переходит в "Пользователи" → "Добавить пользователя"
2. Указывает роль (Аналитик / Компания)
3. Для роли "Компания" привязывает к компании
4. Устанавливает начальный пароль

### 3. Аналитик проводит аудит

1. Создаёт новый аудит, выбирая компанию и тип анкеты
2. Заполняет оценки по каждому критерию
3. Добавляет комментарии (необязательно)
4. Пишет итоговые комментарии
5. Завершает аудит

### 4. Компания просматривает отчёт

1. Переходит в "Отчёты"
2. Выбирает завершённый аудит
3. Видит общую оценку, детализацию по категориям
4. Читает комментарии аналитика
5. Экспортирует в PDF

## Дополнительные команды

\`\`\`bash
# Открыть Prisma Studio для просмотра БД
npm run prisma:studio

# Сгенерировать Prisma Client после изменения схемы
npx prisma generate

# Создать миграцию (для production)
npx prisma migrate dev --name migration_name
\`\`\`

## Безопасность

- Все пароли хешируются с использованием bcrypt
- Доступ контролируется через NextAuth.js
- Каждая операция проверяет права пользователя
- Компании полностью изолированы друг от друга
- Конфиденциальные вводные данные помечены специальным флагом

## Масштабируемость

- Поддержка неограниченного количества компаний
- Версионирование анкет позволяет изменять их без влияния на историю
- Мягкое удаление обеспечивает сохранение данных для аудита
- Индексы в БД для быстрого поиска

## Поддержка

По вопросам работы системы обращайтесь к администратору.

## Лицензия

Проприетарное ПО. Все права защищены.
